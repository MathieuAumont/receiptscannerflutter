import 'package:flutter/material.dart';
import 'package:shared_preferences/shared_preferences.dart';

class LanguageProvider extends ChangeNotifier {
  static const String _languageKey = 'language';
  
  Locale _locale = const Locale('fr');
  
  Locale get locale => _locale;
  String get languageCode => _locale.languageCode;
  bool get isFrench => _locale.languageCode == 'fr';

  LanguageProvider() {
    _loadLanguage();
  }

  void setLanguage(String languageCode) {
    _locale = Locale(languageCode);
    _saveLanguage();
    notifyListeners();
  }

  void toggleLanguage() {
    _locale = _locale.languageCode == 'fr' 
        ? const Locale('en') 
        : const Locale('fr');
    _saveLanguage();
    notifyListeners();
  }

  Future<void> _loadLanguage() async {
    final prefs = await SharedPreferences.getInstance();
    final languageCode = prefs.getString(_languageKey) ?? 'fr';
    _locale = Locale(languageCode);
    notifyListeners();
  }

  Future<void> _saveLanguage() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString(_languageKey, _locale.languageCode);
  }

  // Translations
  Map<String, String> get translations => _locale.languageCode == 'fr' 
      ? _frenchTranslations 
      : _englishTranslations;

  String translate(String key) {
    return translations[key] ?? key;
  }

  static const Map<String, String> _frenchTranslations = {
    'home': 'Accueil',
    'scan': 'Scanner',
    'manual_entry': 'Ajouter',
    'budget': 'Budget',
    'reports': 'Rapports',
    'settings': 'Param√®tres',
    'receipt_scanner': 'Receipt Scanner',
    'recent_receipts': 'Re√ßus r√©cents',
    'total_budget': 'Budget Total',
    'monthly_spending': 'D√©penses du mois',
    'no_receipts': 'Aucun re√ßu',
    'no_receipts_subtitle': 'Commencez par scanner un re√ßu ou en ajouter un manuellement',
    'scan_receipt': 'Scanner un re√ßu',
    'upload': 'T√©l√©charger',
    'analyzing': 'Analyse en cours...',
    'add_receipt': 'Ajouter un re√ßu',
    'store_name': 'Nom du magasin',
    'date': 'Date',
    'category': 'Cat√©gorie',
    'items': 'Articles',
    'add_item': 'Ajouter un article',
    'item_name': 'Nom de l\'article',
    'price': 'Prix',
    'quantity': 'Quantit√©',
    'subtotal': 'Sous-total',
    'tps': 'TPS (5%)',
    'tvq': 'TVQ (9.975%)',
    'total': 'Total',
    'save': 'Sauvegarder',
    'cancel': 'Annuler',
    'delete': 'Supprimer',
    'edit': 'Modifier',
    'back': 'Retour',
    'loading': 'Chargement...',
    'error': 'Erreur',
    'success': 'Succ√®s',
    'dark_mode': 'Mode sombre',
    'language': 'Langue',
    'preferences': 'Pr√©f√©rences',
    'data_management': 'Gestion des donn√©es',
    'export_data': 'Exporter les donn√©es',
    'clear_all_data': 'Effacer toutes les donn√©es',
    'about': '√Ä propos',
    'version': 'Version',
    'see_all': 'Voir tout',
    'receipt_details': 'D√©tails de la facture',
    'this_month': 'Ce mois',
    'spent': 'D√©pens√©',
    'storage_used': 'Stockage utilis√©',
    'storage_used_subtitle': 'Nombre de re√ßus : {count}',
    'export_csv': 'Exporter les re√ßus en CSV',
    'export_coming_soon': 'Fonction export bient√¥t disponible!',
    'delete_all_data_subtitle': 'Supprimer tous les re√ßus et donn√©es',
    'help_support': 'Aide & Support',
    'app_version': 'Version {version}',
    'footer_copyright': 'Receipt Scanner Flutter ¬© {year}',
    'clear_all_data_confirm': '√ätes-vous s√ªr de vouloir supprimer toutes les donn√©es ? Cette action est irr√©versible.',
    'clear_all_data_success': 'Toutes les donn√©es ont √©t√© supprim√©es avec succ√®s',
    'clear_all_data_error': 'Erreur lors de la suppression des donn√©es',
    'month_format': '{month}',
    'current_month': 'En cours',
    'total_monthly_budget': 'Budget mensuel total',
    'percent_used': '{percent}% utilis√©',
    'no_budget_set': 'Aucun budget d√©fini',
    'add_at_least_one_item': 'Veuillez ajouter au moins un article',
    'enter_store_name': 'Veuillez entrer le nom du magasin',
    'receipt_saved_success': 'Facture sauvegard√©e avec succ√®s',
    'receipt_updated': 'Facture mise √† jour avec succ√®s',
    'error_saving_receipt': 'Erreur lors de la sauvegarde de la facture',
    'tab_analysis': 'üìä Analyse',
    'tab_ai': 'ü§ñ IA',
    'tab_report': 'üìã Rapport',
    'receipts': 'Re√ßus',
    'category_breakdown': 'R√©partition par cat√©gorie',
    'no_data_available': 'Aucune donn√©e disponible',
    'monthly_trend': 'Tendance mensuelle',
    'no_cameras_available': 'Aucune cam√©ra disponible sur cet appareil',
    'failed_initialize_camera': '√âchec de l\'initialisation de la cam√©ra',
    'failed_get_camera_list': 'Impossible d\'obtenir la liste des cam√©ras',
    'failed_take_picture': '√âchec de la prise de photo',
    'failed_pick_image': '√âchec de la s√©lection de l\'image',
    'failed_process_receipt': '√âchec du traitement du re√ßu',
    'receipt_processed_success': 'Re√ßu trait√© avec succ√®s!',
    'help_welcome': 'Bienvenue dans Receipt Scanner!',
    'help_features_title': 'Fonctionnalit√©s principales :',
    'help_features_scan': '‚Ä¢ Scanner une facture : Prenez une photo ou importez une image de votre re√ßu. L\'IA extrait automatiquement les informations importantes (date, montant, commer√ßant, articles, taxes, etc.).',
    'help_features_manual': '‚Ä¢ Ajout manuel : Saisissez une facture √† la main si la photo n\'est pas disponible ou si vous souhaitez corriger/compl√©ter les informations.',
    'help_features_analysis': '‚Ä¢ Analyse et rapports : Consultez vos d√©penses par mois, par cat√©gorie, ou par commer√ßant. Visualisez vos budgets et comparez vos d√©penses r√©elles.',
    'help_features_budget': '‚Ä¢ Budgets : D√©finissez un budget mensuel global ou par cat√©gorie. Suivez votre progression et recevez des alertes si vous d√©passez vos limites.',
    'help_features_export': '‚Ä¢ Export : Exportez vos re√ßus au format CSV pour les utiliser dans d\'autres applications.',
    'help_examples_title': 'Exemples d\'utilisation :',
    'help_example_scan_groceries': '‚Ä¢ Apr√®s vos courses, scannez le ticket pour suivre vos d√©penses alimentaires.',
    'help_example_manual_online': '‚Ä¢ Ajoutez manuellement une facture d\'achat en ligne re√ßue par email.',
    'help_example_monthly_report': '‚Ä¢ Consultez le rapport mensuel pour voir o√π va votre argent.',
    'help_example_budget_restaurant': '‚Ä¢ Fixez un budget "Restaurants" et surveillez vos sorties.',
    'help_need_help': 'Besoin d\'aide ?',
    'help_contact': '‚Ä¢ Pour toute question ou suggestion, contactez-nous via la page de support ou consultez la FAQ sur notre site.',
    'category_shopping': 'Magasinage',
    'category_food': 'Alimentation',
    'category_transport': 'Transport',
    'category_entertainment': 'Loisirs',
    'category_health': 'Sant√©',
    'category_home': 'Maison',
    'general_info': 'Informations g√©n√©rales',
    'summary': 'R√©sum√©',
    'notes_optional': 'Notes (optionnel)',
    'add_notes': 'Ajouter des notes sur ce re√ßu...',
    'saving': 'Sauvegarde en cours...',
    'item': 'Article',
    'prices_include_tax': 'Les prix incluent les taxes',
    'edit_budget': 'Modifier le budget',
    'save_budget': 'Enregistrer le budget',
    'budget_per_category': 'Budget par cat√©gorie',
    'spent_this_month': 'D√©pens√© ce mois-ci',
    'budget_amount': 'Montant du budget',
    'enter_budget_amount': 'Entrez le montant du budget',
    'budget_updated': 'Budget mis √† jour',
    'budget_update_error': 'Erreur lors de la mise √† jour du budget',
    'delete_receipt': 'Supprimer la facture',
    'delete_receipt_confirmation': '√ätes-vous s√ªr de vouloir supprimer cette facture ? Cette action ne peut pas √™tre annul√©e.',
    'notes': 'Notes',
    'edit_receipt': 'Modifier la facture',
    'receipt_not_found': 'Facture non trouv√©e',
  };

  static const Map<String, String> _englishTranslations = {
    'home': 'Home',
    'scan': 'Scan',
    'manual_entry': 'Add',
    'budget': 'Budget',
    'reports': 'Reports',
    'settings': 'Settings',
    'receipt_scanner': 'Receipt Scanner',
    'recent_receipts': 'Recent Receipts',
    'total_budget': 'Total Budget',
    'monthly_spending': 'Monthly Spending',
    'no_receipts': 'No Receipts',
    'no_receipts_subtitle': 'Start by scanning a receipt or adding one manually',
    'scan_receipt': 'Scan Receipt',
    'upload': 'Upload',
    'analyzing': 'Analyzing...',
    'add_receipt': 'Add Receipt',
    'store_name': 'Store Name',
    'date': 'Date',
    'category': 'Category',
    'items': 'Items',
    'add_item': 'Add Item',
    'item_name': 'Item Name',
    'price': 'Price',
    'quantity': 'Quantity',
    'subtotal': 'Subtotal',
    'tps': 'GST (5%)',
    'tvq': 'PST (9.975%)',
    'total': 'Total',
    'save': 'Save',
    'cancel': 'Cancel',
    'delete': 'Delete',
    'edit': 'Edit',
    'back': 'Back',
    'loading': 'Loading...',
    'error': 'Error',
    'success': 'Success',
    'dark_mode': 'Dark Mode',
    'language': 'Language',
    'preferences': 'Preferences',
    'data_management': 'Data Management',
    'export_data': 'Export Data',
    'clear_all_data': 'Clear All Data',
    'about': 'About',
    'version': 'Version',
    'see_all': 'See All',
    'receipt_details': 'Receipt Details',
    'this_month': 'This month',
    'spent': 'Spent',
    'storage_used': 'Storage Used',
    'storage_used_subtitle': 'Number of receipts: {count}',
    'export_csv': 'Export receipts as CSV',
    'export_coming_soon': 'Export feature coming soon!',
    'delete_all_data_subtitle': 'Delete all receipts and data',
    'help_support': 'Help & Support',
    'app_version': 'Version {version}',
    'footer_copyright': 'Receipt Scanner Flutter ¬© {year}',
    'clear_all_data_confirm': 'Are you sure you want to delete all receipts and data? This action cannot be undone.',
    'clear_all_data_success': 'All data cleared successfully',
    'clear_all_data_error': 'Error clearing data',
    'month_format': '{month}',
    'current_month': 'Current',
    'total_monthly_budget': 'Total Monthly Budget',
    'percent_used': '{percent}% used',
    'no_budget_set': 'No budget set',
    'add_at_least_one_item': 'Please add at least one item',
    'enter_store_name': 'Please enter the store name',
    'receipt_saved_success': 'Receipt saved successfully',
    'receipt_updated': 'Receipt updated successfully',
    'error_saving_receipt': 'Error saving receipt',
    'tab_analysis': 'üìä Analysis',
    'tab_ai': 'ü§ñ AI',
    'tab_report': 'üìã Report',
    'receipts': 'Receipts',
    'category_breakdown': 'Category Breakdown',
    'no_data_available': 'No data available',
    'monthly_trend': 'Monthly Trend',
    'no_cameras_available': 'No cameras available on this device',
    'failed_initialize_camera': 'Failed to initialize camera',
    'failed_get_camera_list': 'Failed to get camera list',
    'failed_take_picture': 'Failed to take picture',
    'failed_pick_image': 'Failed to pick image',
    'failed_process_receipt': 'Failed to process receipt',
    'receipt_processed_success': 'Receipt processed successfully!',
    'help_welcome': 'Welcome to Receipt Scanner!',
    'help_features_title': 'Main features:',
    'help_features_scan': '‚Ä¢ Scan a receipt: Take a photo or import an image of your receipt. The AI automatically extracts important information (date, amount, merchant, items, taxes, etc.).',
    'help_features_manual': '‚Ä¢ Manual entry: Enter a receipt by hand if the photo is not available or if you want to correct/complete the information.',
    'help_features_analysis': '‚Ä¢ Analysis and reports: View your expenses by month, by category, or by merchant. Visualize your budgets and compare your actual spending.',
    'help_features_budget': '‚Ä¢ Budgets: Set a global or category budget. Track your progress and get alerts if you exceed your limits.',
    'help_features_export': '‚Ä¢ Export: Export your receipts as CSV for use in other applications.',
    'help_examples_title': 'Usage examples:',
    'help_example_scan_groceries': '‚Ä¢ After shopping, scan the ticket to track your food expenses.',
    'help_example_manual_online': '‚Ä¢ Manually add an online purchase receipt received by email.',
    'help_example_monthly_report': '‚Ä¢ Check the monthly report to see where your money goes.',
    'help_example_budget_restaurant': '‚Ä¢ Set a "Restaurants" budget and monitor your outings.',
    'help_need_help': 'Need help?',
    'help_contact': '‚Ä¢ For any question or suggestion, contact us via the support page or check the FAQ on our website.',
    'category_shopping': 'Shopping',
    'category_food': 'Food',
    'category_transport': 'Transport',
    'category_entertainment': 'Entertainment',
    'category_health': 'Health',
    'category_home': 'Home',
    'general_info': 'General Information',
    'summary': 'Summary',
    'notes_optional': 'Notes (optional)',
    'add_notes': 'Add notes about this receipt...',
    'saving': 'Saving...',
    'item': 'Item',
    'prices_include_tax': 'Prices include taxes',
    'edit_budget': 'Edit Budget',
    'save_budget': 'Save Budget',
    'budget_per_category': 'Budget per Category',
    'spent_this_month': 'Spent this month',
    'budget_amount': 'Budget Amount',
    'enter_budget_amount': 'Enter budget amount',
    'budget_updated': 'Budget updated',
    'budget_update_error': 'Error updating budget',
    'delete_receipt': 'Delete Receipt',
    'delete_receipt_confirmation': 'Are you sure you want to delete this receipt? This action cannot be undone.',
    'notes': 'Notes',
    'edit_receipt': 'Edit Receipt',
    'receipt_not_found': 'Receipt not found',
  };
}